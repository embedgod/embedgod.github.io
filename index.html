<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Embedly ‚Äî Webhook Builder</title>
  <meta name="description" content="A tiny, static HTML tool to craft and send Discord webhook messages with embeds." />
  <style>
    :root{
      --bg:#0f1220; --panel:#151a2e; --muted:#8b94b8; --text:#e6e9ff; --accent:#6ea8ff; --accent-2:#8effc1; --danger:#ff6b6b; --ok:#2dd4bf; --border:#232a4a; --chip:#1b2240;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; background:linear-gradient(120deg, #0f1220 0%, #0f162a 50%, #0f1220 100%); color:var(--text)}
    a{color:var(--accent)}
    .wrap{max-width:1200px; margin:0 auto; padding:24px}
    header{display:flex; gap:12px; align-items:center; justify-content:space-between; margin-bottom:16px}
    .brand{display:flex; gap:12px; align-items:center}
    h1{font-size:20px; margin:0}
    .grid{display:grid; grid-template-columns:1.2fr .8fr; gap:16px}
    .card{background:var(--panel); border:1px solid var(--border); border-radius:16px; box-shadow:0 8px 24px rgba(0,0,0,.25); overflow:hidden}
    .card h2{font-size:14px; letter-spacing:.4px; text-transform:uppercase; color:var(--muted); margin:0; padding:14px 16px; border-bottom:1px solid var(--border)}
    .card .body{padding:16px}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    .row-3{display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px}
    label{font-size:12px; color:var(--muted); display:block; margin:8px 0 4px}
    input[type="text"], input[type="url"], textarea, input[type="color"]{width:100%; background:#0e1326; color:var(--text); border:1px solid var(--border); border-radius:10px; padding:10px 12px; outline:none}
    textarea{min-height:90px; resize:vertical}
    .hint{font-size:12px; color:var(--muted)}
    .btn{display:inline-flex; align-items:center; gap:8px; background:#0f1731; color:var(--text); border:1px solid var(--border); padding:10px 12px; border-radius:12px; cursor:pointer; user-select:none}
    .btn:hover{border-color:#33407a}
    .btn.primary{background:linear-gradient(135deg, #2b3f82, #273a78); border-color:#394b92}
    .btn.ghost{background:transparent}
    .btn.danger{background:linear-gradient(135deg, #6b1f2a, #531821); border-color:#7a2a36}
    .toolbar{display:flex; flex-wrap:wrap; gap:8px}
    .spacer{flex:1}
    .embed{border:1px dashed #2a3566; border-radius:14px; padding:12px; margin:8px 0; background:#101735}
    .embed-header{display:flex; align-items:center; gap:10px}
    .chip{background:var(--chip); color:var(--muted); border:1px solid var(--border); padding:3px 8px; border-radius:999px; font-size:11px}
    details{background:#0f1731; border:1px solid var(--border); border-radius:12px}
    summary{cursor:pointer; padding:8px 10px; color:var(--muted)}
    .fields{display:flex; flex-direction:column; gap:10px}
    .field-item{display:grid; grid-template-columns:1fr 1fr auto; gap:8px; align-items:end}
    .inline-toggle{display:flex; align-items:center; gap:6px; font-size:12px; color:var(--muted)}
    pre{background:#0b0f1f; border-top:1px solid var(--border); margin:0; padding:16px; overflow:auto; max-height:60vh}
    .footer{margin-top:10px; font-size:12px; color:var(--muted)}
    .notice{background:#0f1731; border:1px solid #2f3a6a; padding:10px 12px; border-radius:12px; color:#c9d1ff}
    .switch{position:relative; display:inline-block; width:40px; height:22px}
    .switch input{display:none}
    .slider{position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0; background:#2a335e; transition:.2s; border-radius:999px}
    .slider:before{position:absolute; content:""; height:16px; width:16px; left:3px; bottom:3px; background:white; transition:.2s; border-radius:50%}
    input:checked + .slider{background:#3753ff}
    input:checked + .slider:before{transform:translateX(18px)}
    .custom-footer{margin-top:40px; padding-top:20px; border-top:1px solid var(--border); text-align:center}
    .footer-links{display:flex; justify-content:center; gap:20px; margin-bottom:10px}
    .footer-links a{text-decoration:none; color:var(--accent); padding:5px 10px; border-radius:8px; transition:background-color 0.2s}
    .footer-links a:hover{background-color:rgba(110,168,255,0.1)}
    .inspired{font-size:12px; color:var(--muted)}
    @media (max-width: 980px){.grid{grid-template-columns:1fr}}
    @media (max-width: 600px){.footer-links{flex-direction:column; gap:10px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <h1>Embedly</h1>
        <span class="chip">Static ‚Ä¢ HTML5</span>
      </div>
      <div class="toolbar">
        <button id="btn-send" class="btn primary">üöÄ Send</button>
        <button id="btn-copy" class="btn">üìã Copy JSON</button>
        <button id="btn-save" class="btn">üíæ Save</button>
        <button id="btn-load" class="btn">üìÇ Load</button>
        <button id="btn-export" class="btn">‚¨áÔ∏è Export</button>
        <button id="btn-import" class="btn">‚¨ÜÔ∏è Import</button>
        <button id="btn-clear" class="btn danger">üßπ Clear</button>
      </div>
    </header>

    <div class="notice" role="note">
      Keep your webhook URL secret. Anyone with it can post to your channel. This tool stores data locally in your browser only.
    </div>

    <div class="grid" style="margin-top:12px">
      <section class="card">
        <h2>Composer</h2>
        <div class="body">
          <label>Webhook URL</label>
          <input type="url" id="webhook" placeholder="https://discord.com/api/webhooks/..." />
          <div class="row">
            <div>
              <label>Username (override)</label>
              <input type="text" id="username" placeholder="Optional" />
            </div>
            <div>
              <label>Avatar URL (override)</label>
              <input type="url" id="avatar_url" placeholder="https://..." />
            </div>
          </div>
          <label>Message Content</label>
          <textarea id="content" placeholder="Plain message content (alongside embeds)"></textarea>
          <div style="display:flex; align-items:center; gap:10px; margin:8px 0 14px">
            <span class="inline-toggle"><label for="tts">TTS</label>
              <label class="switch"><input id="tts" type="checkbox"><span class="slider"></span></label>
            </span>
            <span class="inline-toggle"><label for="timestampNow">Embed timestamp: now</label>
              <label class="switch"><input id="timestampNow" type="checkbox"><span class="slider"></span></label>
            </span>
          </div>

          <div class="toolbar" style="margin:6px 0 10px">
            <button class="btn" id="add-embed">‚ûï Add Embed</button>
          </div>

          <div id="embeds"></div>

        </div>
      </section>

      <aside class="card">
        <h2>Payload Preview</h2>
        <div class="body">
          <pre id="json"></pre>
          <div class="footer">Live JSON preview of the payload that will be sent to your Discord webhook.</div>
        </div>
      </aside>
    </div>

    <div class="custom-footer">
      <div class="footer-links">
        <a href="https://discord.gg/rgYy9QjadY" target="_blank">Discord</a>
        <a href="https://github.com/embedgod/embedgod.github.io/tree/main" target="_blank">GitHub</a>
        <a href="https://discohook.org/" target="_blank">Discohook</a>
      </div>
      <div class="inspired">inspired by discohook</div>
    </div>
  </div>

  <template id="embed-template">
    <div class="embed">
      <div class="embed-header">
        <strong style="opacity:.85">Embed</strong>
        <span class="spacer"></span>
        <button class="btn ghost btn-dup">‚ßâ Duplicate</button>
        <button class="btn danger btn-remove">‚úñ Remove</button>
      </div>
      <div class="row">
        <div>
          <label>Title</label>
          <input type="text" class="e-title" placeholder="Title" />
        </div>
        <div>
          <label>URL</label>
          <input type="url" class="e-url" placeholder="https://..." />
        </div>
      </div>
      <label>Description</label>
      <textarea class="e-desc" placeholder="Supports Markdown"></textarea>
      <div class="row-3">
        <div>
          <label>Color</label>
          <input type="text" class="e-color" placeholder="#5865F2 or 5793266" />
        </div>
        <div>
          <label>Thumbnail URL</label>
          <input type="url" class="e-thumb" placeholder="https://..." />
        </div>
        <div>
          <label>Image URL</label>
          <input type="url" class="e-image" placeholder="https://..." />
        </div>
      </div>
      <details>
        <summary>Author, Footer & Extras</summary>
        <div class="row-3" style="padding:10px">
          <div>
            <label>Author name</label>
            <input type="text" class="e-author-name" />
          </div>
          <div>
            <label>Author URL</label>
            <input type="url" class="e-author-url" />
          </div>
          <div>
            <label>Author icon URL</label>
            <input type="url" class="e-author-icon" />
          </div>
        </div>
        <div class="row-3" style="padding:0 10px 10px">
          <div>
            <label>Footer text</label>
            <input type="text" class="e-footer-text" />
          </div>
          <div>
            <label>Footer icon URL</label>
            <input type="url" class="e-footer-icon" />
          </div>
          <div>
            <label>Timestamp (ISO)</label>
            <input type="text" class="e-timestamp" placeholder="2025-01-31T12:00:00Z" />
          </div>
        </div>
      </details>

      <div style="margin-top:10px">
        <div class="toolbar" style="margin-bottom:8px">
          <span class="chip">Fields</span>
          <button class="btn btn-add-field">‚ûï Add Field</button>
          <span class="hint">Set name & value; toggle inline if you like.</span>
        </div>
        <div class="fields"></div>
      </div>
    </div>
  </template>

  <template id="field-template">
    <div class="field-item">
      <div>
        <label>Name</label>
        <input type="text" class="f-name" placeholder="Field name" />
      </div>
      <div>
        <label>Value</label>
        <input type="text" class="f-value" placeholder="Field value" />
      </div>
      <div style="display:flex; gap:6px; align-items:center">
        <label class="switch" title="Inline"><input class="f-inline" type="checkbox"><span class="slider"></span></label>
        <button class="btn danger btn-remove-field" title="Remove">üóë</button>
      </div>
    </div>
  </template>

  <script>
    const $ = (s, el=document) => el.querySelector(s);
    const $$ = (s, el=document) => Array.from(el.querySelectorAll(s));
    const state = { embeds: [] };

    function getISOIfChecked(){ return $('#timestampNow').checked ? new Date().toISOString() : undefined; }

    function toIntColor(input){
      if(!input) return undefined;
      const v = input.trim();
      if(/^#?[0-9a-fA-F]{6}$/.test(v)){
        const hex = v.startsWith('#') ? v.slice(1) : v; return parseInt(hex, 16);
      }
      const n = Number(v); return Number.isFinite(n) ? Math.floor(n) : undefined;
    }

    function buildPayload(){
      const payload = {
        content: $('#content').value || undefined,
        username: $('#username').value || undefined,
        avatar_url: $('#avatar_url').value || undefined,
        tts: $('#tts').checked || undefined,
        embeds: state.embeds.map(e => ({
          title: e.q('.e-title').value || undefined,
          url: e.q('.e-url').value || undefined,
          description: e.q('.e-desc').value || undefined,
          color: toIntColor(e.q('.e-color').value),
          timestamp: (e.q('.e-timestamp').value || getISOIfChecked()) || undefined,
          thumbnail: e.q('.e-thumb').value ? { url: e.q('.e-thumb').value } : undefined,
          image: e.q('.e-image').value ? { url: e.q('.e-image').value } : undefined,
          author: (e.q('.e-author-name').value||e.q('.e-author-url').value||e.q('.e-author-icon').value) ? {
            name: e.q('.e-author-name').value || undefined,
            url: e.q('.e-author-url').value || undefined,
            icon_url: e.q('.e-author-icon').value || undefined,
          } : undefined,
          footer: (e.q('.e-footer-text').value||e.q('.e-footer-icon').value) ? {
            text: e.q('.e-footer-text').value || undefined,
            icon_url: e.q('.e-footer-icon').value || undefined,
          } : undefined,
          fields: e.fields.map(fn => ({
            name: fn.q('.f-name').value || '\u200b',
            value: fn.q('.f-value').value || '\u200b',
            inline: fn.q('.f-inline').checked || false,
          }))
        }))
      };
      if(!payload.embeds.length) delete payload.embeds;
      if(payload.tts === false) delete payload.tts;
      return payload;
    }

    function renderJSON(){
      const payload = buildPayload();
      $('#json').textContent = JSON.stringify(payload, null, 2);
    }

    function saveLocal(){
      const data = { payload: buildPayload(), webhook: $('#webhook').value };
      localStorage.setItem('mini-discohook', JSON.stringify(data));
      alert('Saved locally');
    }
    function loadLocal(){
      const raw = localStorage.getItem('mini-discohook');
      if(!raw) return alert('Nothing saved yet.');
      const data = JSON.parse(raw);
      $('#webhook').value = data.webhook || '';
      loadPayload(data.payload || {});
    }
    function exportFile(){
      const blob = new Blob([JSON.stringify(buildPayload(), null, 2)], {type: 'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob); a.download = 'webhook-payload.json'; a.click(); URL.revokeObjectURL(a.href);
    }
    function importFile(){
      const input = document.createElement('input'); input.type='file'; input.accept='application/json';
      input.onchange = () => { const f = input.files[0]; if(!f) return; const r = new FileReader(); r.onload = () => {
        try{ const obj = JSON.parse(r.result); loadPayload(obj); }catch(e){ alert('Invalid JSON'); }
      }; r.readAsText(f); };
      input.click();
    }

    function clearAll(){ if(confirm('Clear composer?')){ $('#content').value=''; $('#username').value=''; $('#avatar_url').value=''; $('#tts').checked=false; $('#timestampNow').checked=false; state.embeds=[]; $('#embeds').innerHTML=''; renderJSON(); } }

    function addEmbed(data={}){
      const tpl = document.importNode($('#embed-template').content, true);
      const el = tpl.firstElementChild; el.q = (s)=>$(s, el);
      el.fields = [];
      el.q('.e-title').value = data.title||'';
      el.q('.e-url').value = data.url||'';
      el.q('.e-desc').value = data.description||'';
      el.q('.e-color').value = data.color? (typeof data.color==='number'? '#'+data.color.toString(16).padStart(6,'0'): data.color):'';
      el.q('.e-thumb').value = data.thumbnail?.url||'';
      el.q('.e-image').value = data.image?.url||'';
      el.q('.e-author-name').value = data.author?.name||'';
      el.q('.e-author-url').value = data.author?.url||'';
      el.q('.e-author-icon').value = data.author?.icon_url||'';
      el.q('.e-footer-text').value = data.footer?.text||'';
      el.q('.e-footer-icon').value = data.footer?.icon_url||'';
      el.q('.e-timestamp').value = data.timestamp||'';

      el.q('.btn-remove').onclick = () => { state.embeds = state.embeds.filter(x => x!==el); el.remove(); renderJSON(); };
      el.q('.btn-dup').onclick = () => { addEmbed(dataFromEmbed(el)); };
      el.q('.btn-add-field').onclick = () => addField(el);

      ['input','change','keyup'].forEach(evt => el.addEventListener(evt, renderJSON));
      $('#embeds').appendChild(el);
      state.embeds.push(el);
      (data.fields||[]).forEach(f => addField(el, f));
      renderJSON();
    }

    function addField(embedEl, data={}){
      const tpl = document.importNode($('#field-template').content, true);
      const el = tpl.firstElementChild; el.q = (s)=>$(s, el);
      el.q('.f-name').value = data.name||'';
      el.q('.f-value').value = data.value||'';
      el.q('.f-inline').checked = Boolean(data.inline);
      el.q('.btn-remove-field').onclick = () => { embedEl.fields = embedEl.fields.filter(x => x!==el); el.remove(); renderJSON(); };
      ['input','change','keyup'].forEach(evt => el.addEventListener(evt, renderJSON));
      embedEl.q('.fields').appendChild(el);
      embedEl.fields.push(el);
      renderJSON();
    }

    function dataFromEmbed(el){
      const get = (s)=> el.q(s).value;
      return {
        title:get('.e-title'), url:get('.e-url'), description:get('.e-desc'), color:get('.e-color'),
        thumbnail: el.q('.e-thumb').value? {url:get('.e-thumb')} : undefined,
        image: el.q('.e-image').value? {url:get('.e-image')} : undefined,
        author: (el.q('.e-author-name').value||el.q('.e-author-url').value||el.q('.e-author-icon').value)?{
          name:get('.e-author-name'), url:get('.e-author-url'), icon_url:get('.e-author-icon')
        }:undefined,
        footer: (el.q('.e-footer-text').value||el.q('.e-footer-icon').value)?{ text:get('.e-footer-text'), icon_url:get('.e-footer-icon') }:undefined,
        timestamp: get('.e-timestamp') || undefined,
        fields: el.fields.map(f=>({ name:f.q('.f-name').value, value:f.q('.f-value').value, inline:f.q('.f-inline').checked }))
      };
    }

    function loadPayload(payload={}){
      state.embeds=[]; $('#embeds').innerHTML='';
      $('#content').value = payload.content||'';
      $('#username').value = payload.username||'';
      $('#avatar_url').value = payload.avatar_url||'';
      $('#tts').checked = !!payload.tts;
      (payload.embeds || []).forEach(addEmbed);
      renderJSON();
    }

    async function sendPayload(){
      const url = $('#webhook').value.trim();
      if(!/^https:\/\/(canary\.)?discord\.com\/api\/webhooks\//.test(url)){
        return alert('Enter a valid Discord webhook URL.');
      }
      const res = await fetch(url, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(buildPayload()) });
      if(res.ok){ alert('Sent!'); }
      else{ const t = await res.text(); alert('Failed: '+res.status+' '+t); }
    }

    $('#add-embed').onclick = () => addEmbed();
    $('#btn-copy').onclick = async () => { await navigator.clipboard.writeText($('#json').textContent); alert('JSON copied'); };
    $('#btn-save').onclick = saveLocal;
    $('#btn-load').onclick = loadLocal;
    $('#btn-export').onclick = exportFile;
    $('#btn-import').onclick = importFile;
    $('#btn-clear').onclick = clearAll;
    $('#btn-send').onclick = sendPayload;

    $('#webhook').addEventListener('input', e => localStorage.setItem('mini-discohook-webhook', e.target.value));
    $('#webhook').value = localStorage.getItem('mini-discohook-webhook') || '';

    renderJSON();
  </script>
</body>
</html>
